–ü–µ—Ä–µ–¥–µ–ª–∞—é –ø–ª–∞–Ω - —Ç–æ–ª—å–∫–æ –¥–ª—è Yandex Cloud:

üìã –ü–õ–ê–ù –ú–ò–ì–†–ê–¶–ò–ò: GigaChat ‚Üí Yandex AI (—Ç–æ–ª—å–∫–æ Yandex Cloud Function)
–®–ê–ì 1: –ü–ï–†–ï–ú–ï–ù–ù–´–ï –û–ö–†–£–ñ–ï–ù–ò–Ø –≤ Yandex Cloud
–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–≤ –∫–æ–Ω—Å–æ–ª–∏ Yandex Cloud):

YC_API_KEY = "–≤–∞—à API –∫–ª—é—á"
YC_FOLDER_ID = "–≤–∞—à folder ID"
(–û—Å—Ç–∞–ª—å–Ω–æ–µ: TELEGRAM_BOT_TOKEN, VK_ACCESS_TOKEN, YDB_* ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å)

–®–ê–ì 2: –ß–¢–û –ú–ï–ù–Ø–¢–¨ –í /yandex-cloud-function/index.js
–§—É–Ω–∫—Ü–∏—è	–ß—Ç–æ –¥–µ–ª–∞—Ç—å	–°—Ç—Ä–æ–∫–∏
getGigaChatToken()	–£–î–ê–õ–ò–¢–¨ (API Key –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é)	490-521
callGigaChat()	–ü–ï–†–ï–ü–ò–°–ê–¢–¨ –Ω–∞ callYandexGPT()	626-656
getGigaChatFile()	–ü–ï–†–ï–ü–ò–°–ê–¢–¨ –Ω–∞ generateYandexImage()	572-586
–î–æ–±–∞–≤–∏—Ç—å	pollYandexImageStatus() ‚Äî –ù–û–í–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è	‚Äî
handleVkAutoPost()	–ü–ï–†–ï–ü–ò–°–ê–¢–¨ –¥–ª—è Yandex (–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫)	523-570
callGigaChat() –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö	–ó–ê–ú–ï–ù–ò–¢–¨ –Ω–∞ callYandexGPT()	–í–µ–∑–¥–µ –≥–¥–µ –µ—Å—Ç—å
–®–ê–ì 3: –ì–û–¢–û–í–´–ô –ö–û–î –î–õ–Ø –ó–ê–ú–ï–ù–´
3.1 –£–î–ê–õ–ò–¢–¨ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é (—Å—Ç—Ä–æ–∫–∏ 490-521):
async function getGigaChatToken() {
    const now = Date.now();
    if (gigaChatTokenCache.token && gigaChatTokenCache.expiresAt > now) {
        console.log('‚úÖ Using cached GigaChat token (saves ~400ms)');
        return gigaChatTokenCache.token;
    }
    // ... –≤–µ—Å—å –∫–æ–¥ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
}
–ò –£–î–ê–õ–ò–¢–¨ —ç—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é (—Å—Ç—Ä–æ–∫–∞ 45-48):

let gigaChatTokenCache = {
    token: null,
    expiresAt: 0
};
3.2 –ó–ê–ú–ï–ù–ò–¢–¨ callGigaChat() (—Å—Ç—Ä–æ–∫–∏ 626-656):
–ë—ã–ª–æ:

async function callGigaChat(prompt, modelName = 'GigaChat') {
    const token = await getGigaChatToken();
    const response = await httpsRequest('https://gigachat.devices.sberbank.ru/api/v1/chat/completions', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
            model: modelName,
            messages: [{ role: 'user', content: prompt }],
            temperature: 0.7
        })
    });
    const data = JSON.parse(response.data);
    const content = data.choices[0].message.content;
    // ...
}
–ù–æ–≤–æ–µ:

async function callYandexGPT(prompt, modelName = 'yandexgpt') {
    const apiKey = process.env.YC_API_KEY;
    const folderId = process.env.YC_FOLDER_ID;
    if (!apiKey || !folderId) {
        throw new Error('YC_API_KEY or YC_FOLDER_ID not configured');
    }
    const response = await httpsRequest('https://llm.api.cloud.yandex.net/foundationModels/v1/completion', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Api-Key ${apiKey}`
        },
        body: JSON.stringify({
            modelUri: `gpt://${folderId}/${modelName}`,
            completionOptions: {
                stream: false,
                temperature: 0.7,
                maxTokens: '2000'
            },
            messages: [{ role: 'user', text: prompt }]
        })
    });
    const data = JSON.parse(response.data);
    const content = data.result.alternatives[0].message.text;
    return {
        content: content,
        tokens: data.result.usage.totalTokens
    };
}
3.3 –ó–ê–ú–ï–ù–ò–¢–¨ getGigaChatFile() + –î–û–ë–ê–í–ò–¢–¨ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 572-586):
–ë—ã–ª–æ:

async function getGigaChatFile(fileId) {
    try {
        const token = await getGigaChatToken();
        const response = await httpsRequest(`https://gigachat.devices.sberbank.ru/api/v1/files/${fileId}/content`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        return response.data;
    } catch (e) {
        console.error('[GIGACHAT] File download error:', e.message);
        return null;
    }
}
–ù–æ–≤–æ–µ:

async function generateYandexImage(prompt) {
    const apiKey = process.env.YC_API_KEY;
    const folderId = process.env.YC_FOLDER_ID;
    if (!apiKey || !folderId) {
        throw new Error('YC_API_KEY or YC_FOLDER_ID not configured');
    }
    console.log('[YANDEX-ART] Starting image generation...');
    // –®–ê–ì 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
    const startResponse = await httpsRequest('https://llm.api.cloud.yandex.net/foundationModels/v1/imageGenerationAsync', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Api-Key ${apiKey}`
        },
        body: JSON.stringify({
            modelUri: `art://${folderId}/yandex-art/latest`,
            generationOptions: {
                seed: Math.floor(Math.random() * 10000),
                aspectRatio: { widthRatio: '1', heightRatio: '1' }
            },
            messages: [{ weight: '1', text: prompt }]
        })
    });
    if (startResponse.statusCode !== 200) {
        throw new Error(`Image generation request failed: ${startResponse.statusCode}`);
    }
    const operationId = JSON.parse(startResponse.data).id;
    console.log('[YANDEX-ART] Operation ID:', operationId);
    // –®–ê–ì 2: Polling –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    return await pollYandexImageStatus(operationId, apiKey);
}
async function pollYandexImageStatus(operationId, apiKey, maxAttempts = 60) {
    console.log('[YANDEX-ART] Polling image generation status...');
    for (let i = 0; i < maxAttempts; i++) {
        const statusResponse = await httpsRequest(`https://operation.api.cloud.yandex.net/operations/${operationId}`, {
            method: 'GET',
            headers: {
                'Authorization': `Api-Key ${apiKey}`
            }
        });
        if (statusResponse.statusCode !== 200) {
            throw new Error(`Status check failed: ${statusResponse.statusCode}`);
        }
        const status = JSON.parse(statusResponse.data);
        if (status.done) {
            const imageBase64 = status.response.image;
            console.log('[YANDEX-ART] Image generation completed!');
            return Buffer.from(imageBase64, 'base64');
        }
        console.log(`[YANDEX-ART] Waiting... attempt ${i + 1}/${maxAttempts}`);
        await new Promise(resolve => setTimeout(resolve, 2000));
    }
    throw new Error(`Image generation timeout after ${maxAttempts * 2}s`);
}
3.4 –ü–ï–†–ï–ü–ò–°–ê–¢–¨ handleVkAutoPost() (—Å—Ç—Ä–æ–∫–∏ 523-570):
–ë—ã–ª–æ:

async function handleVkAutoPost(headers) {
    try {
        console.log('[VK-AUTO-POST] Starting automation with GigaChat MAX');
        const vkToken = process.env.VK_ACCESS_TOKEN;
        const groupId = process.env.VK_GROUP_ID;
        if (!vkToken || !groupId) {
            throw new Error('VK_ACCESS_TOKEN or VK_GROUP_ID not configured');
        }
        const prompt = "...";
        const aiResponse = await callGigaChat(prompt, 'GigaChat-Max');
        let attachment = '';
        if (aiResponse.image_id) {
            const imageData = await getGigaChatFile(aiResponse.image_id);
            // ...
        }
        // ...
    }
}
–ù–æ–≤–æ–µ:

async function handleVkAutoPostYandex(headers) {
    try {
        console.log('[VK-AUTO-POST-YANDEX] Starting automation with Yandex AI');
        const vkToken = process.env.VK_ACCESS_TOKEN;
        const groupId = process.env.VK_GROUP_ID;
        if (!vkToken || !groupId) {
            throw new Error('VK_ACCESS_TOKEN or VK_GROUP_ID not configured');
        }
        // –¢–ï–ö–°–¢: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ
        const textPrompt = "–ù–∞–ø–∏—à–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π, –≤–æ–≤–ª–µ–∫–∞—é—â–∏–π –ø–æ—Å—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã –≤–µ–±-—Å—Ç—É–¥–∏–∏ –≤ –í–ö. –¢–µ–º–∞: –ø–æ—á–µ–º—É –±–∏–∑–Ω–µ—Å—É –Ω—É–∂–µ–Ω —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∞–π—Ç –≤ 2026 –≥–æ–¥—É. –ü–æ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–º, —Å —Ö—ç—à—Ç–µ–≥–∞–º–∏.";
        console.log('[VK-AUTO-POST-YANDEX] Generating text...');
        const textResponse = await callYandexGPT(textPrompt, 'yandexgpt');
        const postText = textResponse.content;
        console.log('[VK-AUTO-POST-YANDEX] Text generated:', postText.substring(0, 100) + '...');
        // –ö–ê–†–¢–ò–ù–ö–ê: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ!)
        const imagePrompt = "–õ–æ–≥–æ—Ç–∏–ø IT-–∫–æ–º–ø–∞–Ω–∏–∏, –º–∏–Ω–∏–º–∞–ª–∏–∑–º, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω, —Å–∏–Ω–∏–π –∏ –±–µ–ª—ã–π —Ü–≤–µ—Ç–∞, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å";
        console.log('[VK-AUTO-POST-YANDEX] Generating image...');
        const imageBuffer = await generateYandexImage(imagePrompt);
        console.log('[VK-AUTO-POST-YANDEX] Image generated, size:', imageBuffer.length, 'bytes');
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –≤ –í–ö
        const photoId = await uploadPhotoToVk(vkToken, groupId, imageBuffer);
        if (!photoId) {
            throw new Error('Failed to upload photo to VK');
        }
        console.log('[VK-AUTO-POST-YANDEX] Photo uploaded, ID:', photoId);
        // –ü—É–±–ª–∏–∫—É–µ–º –ø–æ—Å—Ç –≤ –í–ö
        const attachment = `&attachment=${photoId}`;
        const vkUrl = `https://api.vk.com/method/wall.post?owner_id=-${groupId}&from_group=1&message=${encodeURIComponent(postText)}&access_token=${vkToken}&v=5.131${attachment}`;
        const vkResult = await httpsRequest(vkUrl, { method: 'POST', headers: {} });
        console.log('[VK-AUTO-POST-YANDEX] VK API Response:', vkResult.data.substring(0, 200));
        return {
            statusCode: 200,
            headers,
            body: JSON.stringify({ success: true, message: 'Post published with Yandex AI', vkResponse: JSON.parse(vkResult.data) })
        };
    } catch (error) {
        console.error('[VK-AUTO-POST-YANDEX] Error:', error.message);
        return {
            statusCode: 500,
            headers,
            body: JSON.stringify({ success: false, error: error.message })
        };
    }
}
3.5 –í handleVkAutoPost() –∑–∞–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å):
–í —Ñ–∞–π–ª–µ, –≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è handleVkAutoPost(), –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è:

–ë—ã–ª–æ:

if (action === 'vk-auto-post' && method === 'POST') {
    return await handleVkAutoPost(headers);
}
–ù–∞:

if (action === 'vk-auto-post' && method === 'POST') {
    return await handleVkAutoPostYandex(headers);
}
–®–ê–ì 4: –ü–†–û–í–ï–†–ö–ê –ó–ê–ú–ï–ù
–ù–∞–π—Ç–∏ –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è callGigaChat –≤ —Ñ–∞–π–ª–µ –∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ callYandexGPT:

# –ù–∞–π—Ç–∏ –≤—Å–µ –º–µ—Å—Ç–∞:
grep -n "callGigaChat" /yandex-cloud-function/index.js
# –û–±—ã—á–Ω–æ —ç—Ç–æ:
# 535: const aiResponse = await callGigaChat(prompt, 'GigaChat-Max');
# –ò –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –º–µ—Å—Ç–∞
–ó–∞–º–µ–Ω–∏—Ç—å –í–°–ï –≤—Ö–æ–∂–¥–µ–Ω–∏—è:

// –ë—ã–ª–æ:
const aiResponse = await callGigaChat(prompt, 'GigaChat-Max');
// –ù–∞:
const textResponse = await callYandexGPT(prompt, 'yandexgpt');
const aiResponse = { content: textResponse.content };
–®–ê–ì 5: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –≤ Yandex Cloud
–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é (Yandex Cloud Console)
–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É —Ñ—É–Ω–∫—Ü–∏–∏
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ Yandex Cloud
–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å VK Auto Post
–¢–ê–ë–õ–ò–¶–ê –ó–ê–ú–ï–ù
–ß—Ç–æ	–ë—ã–ª–æ	–°—Ç–∞–ª–æ	–§–∞–π–ª
–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è	OAuth Bearer	Api-Key	index.js:535
Endpoint —á–∞—Ç–∞	gigachat.devices.sberbank.ru	llm.api.cloud.yandex.net/foundationModels/v1/completion	index.js:626
Endpoint –∫–∞—Ä—Ç–∏–Ω–æ–∫	gigachat.devices.sberbank.ru/api/v1/files	llm.api.cloud.yandex.net/foundationModels/v1/imageGenerationAsync	index.js:572
–§—É–Ω–∫—Ü–∏—è —Ç–µ–∫—Å—Ç–∞	callGigaChat()	callYandexGPT()	index.js
–§—É–Ω–∫—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫	getGigaChatFile()	generateYandexImage() + pollYandexImageStatus()	index.js
VK-–ø–æ—Å—Ç	handleVkAutoPost()	handleVkAutoPostYandex()	index.js:456
–ú–æ–¥–µ–ª—å	GigaChat-Max	yandexgpt (pro)	index.js
–ö–µ—à —Ç–æ–∫–µ–Ω–æ–≤	getGigaChatToken()	–£–¥–∞–ª–∏—Ç—å (API Key –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é)	index.js
–í–æ—Ç –ø–æ–ª–Ω—ã–π –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–ª—è Yandex Cloud Function!